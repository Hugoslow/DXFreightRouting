{% extends "base.html" %}

{% block title %}User Management - DX Freight Routing{% endblock %}

{% block content %}
<div class="page-header">
    <h2>User Management</h2>
    <p>Add and manage system users</p>
</div>

{% if message %}
<div class="card" style="border-left: 4px solid {% if error %}#e74c3c{% else %}#27ae60{% endif %}; margin-bottom: 20px;">
    <p style="color: {% if error %}#e74c3c{% else %}#27ae60{% endif %};">{{ message }}</p>
</div>
{% endif %}

<div class="card">
    <div class="card-header">
        <h3>Add New User</h3>
    </div>
    <form action="/admin/users/add" method="post">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
            <div>
                <label style="display: block; margin-bottom: 5px; color: #a0a0a0;">Username</label>
                <input type="text" name="username" required style="width: 100%; padding: 10px; border: 1px solid #0f3460; border-radius: 5px; background-color: #1a1a2e; color: #ffffff;">
            </div>
            <div>
                <label style="display: block; margin-bottom: 5px; color: #a0a0a0;">Email</label>
                <input type="email" name="email" required style="width: 100%; padding: 10px; border: 1px solid #0f3460; border-radius: 5px; background-color: #1a1a2e; color: #ffffff;">
            </div>
            <div>
                <label style="display: block; margin-bottom: 5px; color: #a0a0a0;">Password</label>
                <input type="password" name="password" required style="width: 100%; padding: 10px; border: 1px solid #0f3460; border-radius: 5px; background-color: #1a1a2e; color: #ffffff;">
            </div>
            <div>
                <label style="display: block; margin-bottom: 5px; color: #a0a0a0;">Role</label>
                <select name="role" required style="width: 100%; padding: 10px; border: 1px solid #0f3460; border-radius: 5px; background-color: #1a1a2e; color: #ffffff;">
                    <option value="Viewer">Viewer</option>
                    <option value="Operator">Operator</option>
                    <option value="Admin">Admin</option>
                </select>
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Add User</button>
    </form>
</div>

<div class="card">
    <div class="card-header">
        <h3>Current Users ({{ users|length }})</h3>
    </div>
    <table>
        <thead>
            <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Role</th>
                <th>Status</th>
                <th>Last Login</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for u in users %}
            <tr>
                <td>{{ u.username }}</td>
                <td>{{ u.email }}</td>
                <td>{{ u.role }}</td>
                <td>
                    {% if u.is_active %}
                    <span class="badge badge-success">Active</span>
                    {% else %}
                    <span class="badge badge-danger">Disabled</span>
                    {% endif %}
                </td>
                <td>{{ u.last_login if u.last_login else 'Never' }}</td>
                <td>{{ u.created_at }}</td>
                <td>
                    {% if u.username != 'admin' %}
                    {% if u.is_active %}
                    <form action="/admin/users/disable/{{ u.id }}" method="post" style="display: inline;">
                        <button type="submit" class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;">Disable</button>
                    </form>
                    {% else %}
                    <form action="/admin/users/enable/{{ u.id }}" method="post" style="display: inline;">
                        <button type="submit" class="btn btn-primary" style="padding: 4px 8px; font-size: 12px;">Enable</button>
                    </form>
                    {% endif %}
                    <form action="/admin/users/reset-password/{{ u.id }}" method="post" style="display: inline; margin-left: 5px;">
                        <button type="submit" class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;">Reset PW</button>
                    </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}